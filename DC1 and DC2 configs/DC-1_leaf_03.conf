version 25.2R1.9;
system {
    host-name DC-1_Leaf_03;
    root-authentication {
        encrypted-password "$6$cBK/xM4S$Au/E./c8Ede1zNVxZFGwT69ZlPhV/uLj8WeLbmtE6ZjvrP3KzBiTgDQWeYBhNyHbM/528CJgAZ2QmImsgJZEc0"; ## SECRET-DATA
    }
    services {
        netconf {
            ssh;
        }
        ssh {
            root-login allow;
            sftp-server;
        }
    }
    arp {
        aging-timer 5;
    }
    management-instance;
    syslog {
        file interactive-commands {
            interactive-commands any;
        }
        file messages {
            any notice;
            authorization info;
        }
    }
    processes {
        dhcp-service {
            traceoptions {
                file dhcp_logfile size 10m;
                level all;
                flag packet;
            }
        }
    }
}
interfaces {
    ge-0/0/0 {
        description "To DC-1_Spine-01";
        mtu 9192;
        unit 0 {
            family inet;
            family inet6;
        }
    }
    ge-0/0/1 {
        description "To DC-1_Spine-02";
        mtu 9192;
        unit 0 {
            family inet;
            family inet6;
        }
    }
    ge-0/0/2 {
        flexible-vlan-tagging;
        mtu 9192;
        encapsulation extended-vlan-bridge;
        unit 10 {
            vlan-id 10;
        }
        unit 20 {
            vlan-id 20;
        }
        unit 30 {
            vlan-id 30;
        }
        unit 40 {
            vlan-id 40;
        }
    }
    fxp0 {
        unit 0 {
            family inet {
                dhcp {
                    vendor-id Juniper-ex9214-VM697AE5A0F5;
                }
            }
        }
    }
    irb {
        mtu 9192;
        unit 10 {
            family inet {
                address 192.168.30.254/24;
            }
            mac 00:00:00:00:00:11;
        }
        unit 20 {
            family inet {
                address 192.168.30.254/24;
            }
            mac 00:00:00:00:00:11;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 10.100.1.3/32;
            }
        }
    }
}
multi-chassis {
    mc-lag {
        consistency-check;
    }
}
policy-options {
    policy-statement BGP_allow-loopback {
        term 1 {
            from interface lo0.0;
            then accept;
        }
        term 2 {
            then reject;
        }
    }
    policy-statement PFE-ECMP {
        then {
            load-balance per-flow;
        }
    }
}
routing-instances {
    Tenant-1_ipvrf {
        instance-type vrf;
        protocols {
            evpn {
                irb-symmetric-routing {
                    vni 50000;
                }
                ip-prefix-routes {
                    advertise direct-nexthop;
                    encapsulation vxlan;
                    vni 50000;
                }
            }
        }
        interface irb.10;
        route-distinguisher 10.100.1.3:50000;
        vrf-target target:50000:50000;
    }
    Tenant-1_macvrf {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation vxlan;
                default-gateway do-not-advertise;
                extended-vni-list 10300;
            }
        }
        vtep-source-interface lo0.0;
        service-type vlan-aware;
        route-distinguisher 10.100.1.3:1;
        vrf-target target:1:1;
        vlans {
            Tenant-1_network-3 {
                vlan-id none;
                interface ge-0/0/2.10;
                l3-interface irb.10;
                vxlan {
                    vni 10300;
                }
            }
        }
    }
    Tenant-2_ipvrf {
        instance-type vrf;
        protocols {
            evpn {
                irb-symmetric-routing {
                    vni 50001;
                }
                ip-prefix-routes {
                    advertise direct-nexthop;
                    encapsulation vxlan;
                    vni 50001;
                }
            }
        }
        interface irb.20;
        route-distinguisher 10.100.1.3:50001;
        vrf-target target:50001:50001;
    }
    Tenant-2_macvrf {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation vxlan;
                default-gateway do-not-advertise;
                extended-vni-list 20300;
            }
        }
        vtep-source-interface lo0.0;
        service-type vlan-aware;
        route-distinguisher 10.100.1.3:2;
        vrf-target target:1:2;
        vlans {
            Tenant-2_network-3 {
                vlan-id none;
                interface ge-0/0/2.20;
                l3-interface irb.20;
                vxlan {
                    vni 20300;
                }
            }
        }
    }
}
routing-options {
    router-id 10.100.1.3;
    autonomous-system 4201001003;
    forwarding-table {
        export PFE-ECMP;
    }
}
protocols {
    router-advertisement {
        interface ge-0/0/0.0;
        interface ge-0/0/1.0;
    }
    bgp {
        group auto-underlay_spines {
            type external;
            family inet {
                unicast {
                    extended-nexthop;
                }
            }
            family inet6 {
                unicast;
            }
            export BGP_allow-loopback;
            peer-as 4201002000;
            multipath;
            bfd-liveness-detection {
                minimum-interval 333;
            }
            dynamic-neighbor spines {
                peer-auto-discovery {
                    family inet6 {
                        ipv6-nd;
                    }
                    interface ge-0/0/0.0;
                    interface ge-0/0/1.0;
                }
            }
        }
        group overlay_spines {
            type external;
            multihop;
            local-address 10.100.1.3;
            family evpn {
                signaling;
            }
            authentication-key "$9$TQ/t1IclvLhSbsg4ZG/CAt1R"; ## SECRET-DATA
            peer-as 4201002000;
            bfd-liveness-detection {
                minimum-interval 333;
                multiplier 3;
            }
            neighbor 10.100.2.1 {
                description DC-1_Spine_01;
            }
            neighbor 10.100.2.2 {
                description DC-1_Spine_02;
            }
        }
    }
}
