routing-instances {
        Tenant-A-102400_ipvrf {
            instance-type vrf;
            protocols {
                evpn {
                    irb-symmetric-routing {
                        vni 102400;
                    }
                    ip-prefix-routes {
                        advertise direct-nexthop;
                        encapsulation vxlan;
                        vni 102400;
                    }
                }
            }
            interface irb.1;
            interface irb.2;
            interface irb.3;

            route-distinguisher 100:102400;
            vrf-target target:100:102400;
        }
        Tenant-A-102400_macvrf {
            instance-type mac-vrf;

            vlans {

                  vlan-5bbb {
                      vlan-id none;
                      l3-interface irb.1;
                      vxlan { vni 102401; }

                      interface ge-0/0/2.2;
                  }

                  vlan-5eb6 {
                      vlan-id none;
                      l3-interface irb.2;
                      vxlan { vni 102402; }

                      interface ge-0/0/2.3;
                  }

                  vlan-2e21 {
                      vlan-id none;
                      l3-interface irb.3;
                      vxlan { vni 102403; }

                      interface ge-0/0/2.4;
                  }
            }
            vtep-source-interface lo0.0;
            service-type vlan-aware;
            route-distinguisher 100:102401;
            vrf-target target:100:102401;

            protocols {
                evpn {
                    encapsulation vxlan;
                    default-gateway do-not-advertise;
                    extended-vni-list [ 102401 102402 102403 ];
                }
            }
        }
        Tenant-A-102404_ipvrf {
            instance-type vrf;
            protocols {
                evpn {
                    irb-symmetric-routing {
                        vni 102404;
                    }
                    ip-prefix-routes {
                        advertise direct-nexthop;
                        encapsulation vxlan;
                        vni 102404;
                    }
                }
            }
            interface irb.4;
            interface irb.5;

            route-distinguisher 100:102404;
            vrf-target target:100:102404;
        }
        Tenant-A-102404_macvrf {
            instance-type mac-vrf;

            vlans {

                  vlan-e424 {
                      vlan-id none;
                      l3-interface irb.4;
                      vxlan { vni 102405; }

                      interface ge-0/0/2.5;
                  }

                  vlan-92a9 {
                      vlan-id none;
                      l3-interface irb.5;
                      vxlan { vni 102406; }

                      interface ge-0/0/2.6;
                  }
            }
            vtep-source-interface lo0.0;
            service-type vlan-aware;
            route-distinguisher 100:102405;
            vrf-target target:100:102405;

            protocols {
                evpn {
                    encapsulation vxlan;
                    default-gateway do-not-advertise;
                    extended-vni-list [ 102405 102406 ];
                }
            }
        }

        Tenant-B-204800_ipvrf {
            instance-type vrf;
            protocols {
                evpn {
                    irb-symmetric-routing {
                        vni 204800;
                    }
                    ip-prefix-routes {
                        advertise direct-nexthop;
                        encapsulation vxlan;
                        vni 204800;
                    }
                }
            }
            interface irb.6;
            interface irb.7;
            interface irb.8;

            route-distinguisher 200:204800;
            vrf-target target:200:204800;
        }
        Tenant-B-204800_macvrf {
            instance-type mac-vrf;

            vlans {

                  vlan-5bbb {
                      vlan-id none;
                      l3-interface irb.6;
                      vxlan { vni 204801; }

                      interface ge-0/0/2.7;
                  }

                  vlan-5eb6 {
                      vlan-id none;
                      l3-interface irb.7;
                      vxlan { vni 204802; }

                      interface ge-0/0/2.8;
                  }

                  vlan-2e21 {
                      vlan-id none;
                      l3-interface irb.8;
                      vxlan { vni 204803; }

                      interface ge-0/0/2.9;
                  }
            }
            vtep-source-interface lo0.0;
            service-type vlan-aware;
            route-distinguisher 200:204801;
            vrf-target target:200:204801;

            protocols {
                evpn {
                    encapsulation vxlan;
                    default-gateway do-not-advertise;
                    extended-vni-list [ 204801 204802 204803 ];
                }
            }
        }
        Tenant-B-204804_ipvrf {
            instance-type vrf;
            protocols {
                evpn {
                    irb-symmetric-routing {
                        vni 204804;
                    }
                    ip-prefix-routes {
                        advertise direct-nexthop;
                        encapsulation vxlan;
                        vni 204804;
                    }
                }
            }
            interface irb.9;
            interface irb.10;

            route-distinguisher 200:204804;
            vrf-target target:200:204804;
        }
        Tenant-B-204804_macvrf {
            instance-type mac-vrf;

            vlans {

                  vlan-e424 {
                      vlan-id none;
                      l3-interface irb.9;
                      vxlan { vni 204805; }

                      interface ge-0/0/2.10;
                  }

                  vlan-92a9 {
                      vlan-id none;
                      l3-interface irb.10;
                      vxlan { vni 204806; }

                      interface ge-0/0/2.11;
                  }
            }
            vtep-source-interface lo0.0;
            service-type vlan-aware;
            route-distinguisher 200:204805;
            vrf-target target:200:204805;

            protocols {
                evpn {
                    encapsulation vxlan;
                    default-gateway do-not-advertise;
                    extended-vni-list [ 204805 204806 ];
                }
            }
        }

}



policy-options {
    policy-statement BGP_allow-loopback {
        term 1 {
            from interface lo0.0;
            then accept;
        }
        term 2 {
            then reject;
        }
    }
    policy-statement PFE-ECMP {
        then {
            load-balance per-flow;
        }
    }
}

routing-options {
    router-id 2.2.2.2
    autonomous-system 65000;
    forwarding-table {
        export PFE-ECMP;
    }
}

interfaces {
    lo0 {
        unit 0 {
            family inet {
                address 2.2.2.2;
            }
        }
    }
    irb {
        mtu 9192;
        unit 1 {
            family inet6 {
                address 2001:db8:1520:5bbb::1/64;
            }
        }
        unit 2 {
            family inet6 {
                address 2001:db8:1520:5eb6::1/64;
            }
        }
        unit 3 {
            family inet6 {
                address 2001:db8:1520:2e21::1/64;
            }
        }
        unit 4 {
            family inet6 {
                address 2001:db8:1520:e424::1/64;
            }
        }
        unit 5 {
            family inet6 {
                address 2001:db8:1520:92a9::1/64;
            }
        }
        unit 6 {
            family inet6 {
                address 2001:db8:c63c:5bbb::1/64;
            }
        }
        unit 7 {
            family inet6 {
                address 2001:db8:c63c:5eb6::1/64;
            }
        }
        unit 8 {
            family inet6 {
                address 2001:db8:c63c:2e21::1/64;
            }
        }
        unit 9 {
            family inet6 {
                address 2001:db8:c63c:e424::1/64;
            }
        }
        unit 10 {
            family inet6 {
                address 2001:db8:c63c:92a9::1/64;
            }
        }
    }
    ge-0/0/0 {
        description "Uplink-to-spine01 [ge-0/0/1]";
        mtu 9192;
        unit 0 {
            family inet;
            family inet6;
        }
    }


    ge-0/0/2 {
        flexible-vlan-tagging;
        encapsulation extended-vlan-bridge;

        unit 2 {
            vlan-id 2;
            description "100_5bbb";
        }
        unit 3 {
            vlan-id 3;
            description "100_5eb6";
        }
        unit 4 {
            vlan-id 4;
            description "100_2e21";
        }
        unit 5 {
            vlan-id 5;
            description "100_e424";
        }
        unit 6 {
            vlan-id 6;
            description "100_92a9";
        }
        unit 7 {
            vlan-id 7;
            description "200_5bbb";
        }
        unit 8 {
            vlan-id 8;
            description "200_5eb6";
        }
        unit 9 {
            vlan-id 9;
            description "200_2e21";
        }
        unit 10 {
            vlan-id 10;
            description "200_e424";
        }
        unit 11 {
            vlan-id 11;
            description "200_92a9";
        }
    }
}

protocols {
    router-advertisement {
        interface ge-0/0/0.0;
    }

    bgp {
        group auto-underlay_spines {
            type external;
            family inet {
                unicast {
                    extended-nexthop;
                }
            }
            family inet6 {
                unicast;
            }
            export BGP_allow-loopback;
            peer-as 65001;
            multipath;
            bfd-liveness-detection {
                minimum-interval 333;
                multiplier 3;
            }
            dynamic-neighbor spines {
                peer-auto-discovery {
                    family inet6 {
                        ipv6-nd;
                    }
                interface ge-0/0/0.0;
                }
            }
        }
        group overlay_spines {
            type external;
            multihop;
            local-address 2.2.2.2;
            family evpn {
                signaling;
            }
            peer-as 65001;
            bfd-liveness-detection {
                minimum-interval 333;
                multiplier 3;
            }
            neighbor 3.3.3.3 {
                description Link-to-spine01;
            }
        }
    }
}
